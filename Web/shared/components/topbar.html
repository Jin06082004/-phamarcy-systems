<header class="topbar">
  <div class="container topbar-content">
    <div class="logo">
      <!-- <img src="/shared/images/logo.png" alt="logo" onerror="this.style.display='none'" /> -->
      <h1>Drug<span>Store</span></h1>
    </div>
    <div class="search-box">
      <input type="text" id="globalSearchInput" placeholder="TÃ¬m thuá»‘c, vitamin, thá»±c pháº©m..." />
      <button id="globalSearchBtn">ğŸ”</button>
    </div>
    <div class="user-actions" id="userActions">
      <a href="/Web/user/pages/cart.html" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.25rem; background: white; color: #1f2937; text-decoration: none; border-radius: 10px; font-weight: 500; transition: all 0.3s; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <span style="font-size: 1.25rem;">ğŸ›’</span>
        <span>Giá» hÃ ng</span>
      </a>
      <a href="/Web/user/pages/login.html" id="loginBtn" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.25rem; background: white; color: #1f2937; text-decoration: none; border-radius: 10px; font-weight: 500; transition: all 0.3s; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <span style="font-size: 1.25rem;">ğŸ‘¤</span>
        <span>ÄÄƒng nháº­p</span>
      </a>
      <div id="userInfo" style="display: none; align-items: center; gap: 1rem;">
        <a href="/Web/user/pages/profile.html" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1.25rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 12px; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); transition: all 0.3s; text-decoration: none;">
          <div style="width: 40px; height: 40px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            ğŸ‘¤
          </div>
          <div style="display: flex; flex-direction: column; gap: 0.125rem;">
            <span style="font-size: 0.75rem; color: rgba(255,255,255,0.9); font-weight: 500;">Xin chÃ o,</span>
            <span id="userName" style="font-weight: 700; color: white; font-size: 0.95rem;"></span>
          </div>
        </a>
        <a href="#" id="logoutBtn" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.25rem; background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border-radius: 10px; text-decoration: none; font-weight: 600; transition: all 0.3s; box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);">
          <span style="font-size: 1.125rem;">ğŸšª</span>
          <span>ÄÄƒng xuáº¥t</span>
        </a>
      </div>
    </div>
  </div>
</header>

<style>
  .user-actions a:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
    background: #f9fafb !important;
  }
  
  #userInfo > a:first-child:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4) !important;
  }
  
  #logoutBtn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4) !important;
    background: linear-gradient(135deg, #dc2626, #b91c1c) !important;
  }

  /* Search box styles */
  .search-box {
    position: relative;
  }

  #globalSearchInput {
    transition: box-shadow 0.3s;
  }

  #globalSearchInput:focus {
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
    outline: none;
  }

  #globalSearchBtn {
    transition: all 0.3s;
    cursor: pointer;
  }

  #globalSearchBtn:hover {
    transform: scale(1.1);
  }
</style>

<script>
  // Check if user is logged in and update UI
  (function() {
    const userStr = localStorage.getItem('user');
    const loginBtn = document.getElementById('loginBtn');
    const userInfo = document.getElementById('userInfo');
    const userName = document.getElementById('userName');
    const logoutBtn = document.getElementById('logoutBtn');

    if (userStr) {
      try {
        const user = JSON.parse(userStr);
        if (user.username || user.full_name) {
          // Hide login button
          loginBtn.style.display = 'none';
          // Show user info
          userInfo.style.display = 'flex';
          userName.textContent = user.full_name || user.username || 'User';
          
          // Add logout handler
          logoutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (confirm('Báº¡n cÃ³ cháº¯c muá»‘n Ä‘Äƒng xuáº¥t?')) {
              localStorage.removeItem('user');
              localStorage.removeItem('token');
              localStorage.removeItem('cart');
              localStorage.removeItem('guest_token');
              window.location.href = '/Web/user/index.html';
            }
          });
        }
      } catch (e) {
        console.error('Error parsing user data:', e);
      }
    }
  })();

  // Global search functionality
  (function() {
    const searchInput = document.getElementById('globalSearchInput');
    const searchBtn = document.getElementById('globalSearchBtn');

    // HÃ m thá»±c hiá»‡n tÃ¬m kiáº¿m
    function performSearch() {
      const keyword = searchInput.value.trim();
      
      if (!keyword) {
        alert('âš ï¸ Vui lÃ²ng nháº­p tá»« khÃ³a tÃ¬m kiáº¿m');
        searchInput.focus();
        return;
      }

      // Chuyá»ƒn Ä‘áº¿n trang drugs.html vá»›i query parameter
      const searchUrl = `/Web/user/pages/drugs.html?search=${encodeURIComponent(keyword)}`;
      window.location.href = searchUrl;
    }

    // TÃ¬m kiáº¿m khi nháº¥n nÃºt
    searchBtn.addEventListener('click', performSearch);

    // TÃ¬m kiáº¿m khi nháº¥n Enter
    searchInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        performSearch();
      }
    });
  })();
</script>
